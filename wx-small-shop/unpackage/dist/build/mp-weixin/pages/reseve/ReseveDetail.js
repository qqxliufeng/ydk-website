(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/reseve/ReseveDetail"],{"16ca":function(t,e,i){"use strict";i.r(e);var o=i("aca5"),n=i.n(o);for(var s in o)"default"!==s&&function(t){i.d(e,t,function(){return o[t]})}(s);e["default"]=n.a},2256:function(t,e,i){"use strict";var o=i("d87e"),n=i.n(o);n.a},aca5:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){return i.e("pages/reseve/components/TicketInfo").then(i.bind(null,"177c"))},n=function(){return i.e("pages/reseve/components/TicketDiscount").then(i.bind(null,"0259"))},s=function(){return i.e("pages/reseve/components/TicketUserInfo").then(i.bind(null,"b7a9"))},r=function(){return i.e("pages/reseve/components/TicketContact").then(i.bind(null,"b2b2"))},a=function(){return i.e("componets/uni/rate/uni-icon").then(i.bind(null,"3114"))},c={name:"ReseveDetail",components:{TicketInfo:o,TicketDiscount:n,TicketUserInfo:s,TicketContact:r,uniIcon:a},data:function(){return{ticketInfo:null,totalPrice:0,contacts:[],tempDate:null,collectionState:0,touristCount:1}},watch:{ticketInfo:function(t,e){var i=this;t&&this.$nextTick(function(){i.$refs.ticketInfo.init()})}},methods:{getData:function(){var t=this;this.$http(this.$urlPath.orderReserve,{goods_id:this.$routeParams.goodsId,identity:this.$ids.identity,store_id:this.$ids.storeId,goods_source:this.$routeParams.goods_source||"",s_id:this.$routeParams.scenicId},"",function(e){t.ticketInfo=e.data,t.collectionState=e.data.is_favorites},function(e,i){t.$toast(i)})},onSelectedTimeItem:function(t){if(t.item){if(2===this.ticketInfo.valid_period&&0===this.ticketInfo.valid_period_expire)return this.$toast("该票已不能购买"),void(this.totalPrice=0);if(-2===t.item.one_stock)this.$toast("此票在所选日期禁售");else if(-1===t.item.one_stock)this.tempDate=t.item,this.touristCount=t.num,this.totalPrice=(Number(t.item.sale_price)*parseInt(t.num)).toFixed(2);else{if(t.item.one_stock<this.ticketInfo.goods.min_number)return this.totalPrice=0,void this.$toast("所选日期余票小于最低购买数");this.tempDate=t.item,this.touristCount=t.num,this.totalPrice=(Number(t.item.sale_price)*parseInt(t.num)).toFixed(2)}}},collection:function(){var t=this;this.$http(this.$urlPath.userUnFavoroteGoodsUrl,{goods_id:this.$routeParams.goodsId},"正在操作…",function(e){1===t.collectionState?(t.$toast("取消收藏成功"),t.collectionState=0,t.ticketInfo.is_favorites=t.collectionState):(t.$toast("收藏成功"),t.collectionState=1,t.ticketInfo.is_favorites=t.collectionState)},function(e,i){t.$toast(i)})},reserve:function(){var e=this;if(this.tempDate){if(0===this.ticketInfo.goods.play_info||this.checkUserInfo()){var i={};switch(this.tempDate.num=this.touristCount,i.date=this.tempDate,this.ticketInfo.goods.play_info){case 1:i.contact=this.$refs.userSingleInfo.tempUserInfo,i.user=[this.$refs.userSingleInfo.tempUserInfo];break;case 2:if(i.user=[],this.$refs.userInfo){var o=this.$refs.userInfo.userList;o.forEach(function(t){"add"!==t.type&&i.user.push(t)})}i.contact=this.$refs.userSingleInfo.tempUserInfo,i.user.push(this.$refs.userSingleInfo.tempUserInfo);break}i.info={identity:this.$ids.identity,store_id:this.$ids.storeId,goods_source:this.ticketInfo.goods.goods_source,goods_id:this.$routeParams.goodsId},this.$http(this.$urlPath.orderCreate,{data:JSON.stringify(i)},"正在提交…",function(i){e.$toast("订单提交成功"),t.$emit("orderUpdate"),e.$replace(e.$mRouter.orderInfoPay({no:i.data.out_trade_no}))},function(t,i){e.$toast(i)})}}else this.$toast("请选择游玩日期")},checkUserInfo:function(){if(this.$refs.userSingleInfo){var t=this.$refs.userSingleInfo.tempUserInfo.name,e=this.$refs.userSingleInfo.tempUserInfo.phone,i=this.$refs.userSingleInfo.tempUserInfo.idCard,o=this.$refs.userSingleInfo.tempUserInfo.schoolName,n=this.$refs.userSingleInfo.tempUserInfo.studentId;return t||-1===this.ticketInfo.goods.visitor_info.indexOf("n")?e||-1===this.ticketInfo.goods.visitor_info.indexOf("m")?e&&!this.$utils.validator.isPhone(e)?(this.$toast("请输入合法的手机号"),!1):i||-1===this.ticketInfo.goods.visitor_info.indexOf("id")?i&&!this.$utils.validator.checkIdCard(i)?(this.$toast("请输入合法的身份证号"),!1):o||-1===this.ticketInfo.goods.visitor_info.indexOf("u")?!(!n&&-1!==this.ticketInfo.goods.visitor_info.indexOf("s"))||(this.$toast("请输入学生证号"),!1):(this.$toast("请输入学校名称"),!1):(this.$toast("请输入身份证号"),!1):(this.$toast("请输入游客手机号"),!1):(this.$toast("请输入游客姓名"),!1)}return!1},deleteContact:function(t){var e=!0,i=!1,o=void 0;try{for(var n,s=this.contacts[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value;if(r.l_name===t.name)return void this.contacts.splice(this.contacts.indexOf(r),1)}}catch(a){i=!0,o=a}finally{try{e||null==s.return||s.return()}finally{if(i)throw o}}}},onLoad:function(){this.getData()},onShow:function(){var t=getApp().globalData.contact;if(getApp().globalData.contact=null,t){var e=!0,i=!1,o=void 0;try{for(var n,s=this.contacts[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var r=n.value;if(r.l_id===t.l_id)return}}catch(a){i=!0,o=a}finally{try{e||null==s.return||s.return()}finally{if(i)throw o}}this.contacts.push(t)}}};e.default=c}).call(this,i("543d")["default"])},d87e:function(t,e,i){},dec3:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement;t._self._c},n=[];i.d(e,"a",function(){return o}),i.d(e,"b",function(){return n})},f34c:function(t,e,i){"use strict";i.r(e);var o=i("dec3"),n=i("16ca");for(var s in n)"default"!==s&&function(t){i.d(e,t,function(){return n[t]})}(s);i("2256");var r=i("2877"),a=Object(r["a"])(n["default"],o["a"],o["b"],!1,null,"68db62ef",null);e["default"]=a.exports}},[["4510","common/runtime","common/vendor"]]]);